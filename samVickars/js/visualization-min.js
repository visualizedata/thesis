function getD3(){var t=document.body.getBoundingClientRect(),e=map.getCenter(),r=map.getZoom(),a=256/Math.PI*Math.pow(2,r);return d3.geoMercator().center([e.lng,e.lat]).translate([t.width/2,t.height/2]).scale(a)}function getD3Right(){var t=document.getElementById("sTmap").getBoundingClientRect(),e=mapR.getCenter(),r=mapR.getZoom(),a=256/Math.PI*Math.pow(2,r);return d3.geoMercator().center([e.lng,e.lat]).translate([t.width/2,t.height/2]).scale(a)}function pageSix(t){d3.selectAll(".overlay").remove(),d3.selectAll(".dot").classed("schoolMarker",!0).style("opacity",1),d3.selectAll(".label").classed("schoolLabel",!0).style("opacity",1);var e=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1,d3.json("js/data/stories/stories.json",function(r){r=r.stories.filter(function(e){return e.name===t}),r=r[0],map.flyTo({center:[r.latLng.lng,r.latLng.lat],zoom:r.zoom,bearing:0,speed:100,curve:1,easing:function(t){return t}}),d3.select("#dot-"+r.schoolID).classed("schoolMarker",!1),d3.select("#label-"+r.schoolID).classed("schoolLabel",!1),new ScrollMagic.Scene({triggerElement:"#tMap1_zo"}).addTo(e).on("progress",function(t){"FORWARD"===t.scrollDirection?($(".legendCenterText").html(story.name+" was one of an estimated <span class='orange'>150,000</span> Aboriginal children to attend a residential school in Canada."),$(".legendRight").html('<a href="#tMap1_irs"><div class="legendRightContainer"><div class="legendRightInner"><div class="passRight faa-passing animated"><i class="fa fa-arrow-right"></i></div></div></div></a>'),d3.selectAll(".schoolLabel").style("opacity","0"),d3.selectAll(".schoolMarker").style("opacity","0"),mapStatus="zoomedOut",map.flyTo({center:[-100,58],zoom:4,bearing:0,speed:1,curve:1,easing:function(t){return t}})):(d3.select("#dot-"+r.schoolID).style("opacity",1),d3.select("#label-"+r.schoolID).style("opacity",1),mapStatus="zoomedIn",map.flyTo({center:[r.latLng.lng,r.latLng.lat],zoom:r.zoom,bearing:0,speed:5,curve:1,easing:function(t){return t}}))}),new ScrollMagic.Scene({triggerElement:"#tMap1_irs"}).addTo(e).on("progress",function(t){"FORWARD"===t.scrollDirection?($(".legendCenterText").html("There were <span class='orange'>132</span> schools located throughout the country."),$(".legendRight").html('<a href="#tMap1_reserves"><div class="legendRightContainer"><div class="legendRightInner"><div class="passRight faa-passing animated"><i class="fa fa-arrow-right"></i></div></div></div></a>'),d3.selectAll(".schoolMarker").transition().duration(600).ease(d3.easeLinear).style("opacity",1),d3.select("#label-"+r.schoolID).transition().duration(600).ease(d3.easeLinear).style("opacity",0)):(d3.selectAll(".schoolMarker").transition().duration(600).ease(d3.easeLinear).style("opacity",0),d3.select("#label-"+r.schoolID).transition().duration(600).ease(d3.easeLinear).style("opacity",1))}),new ScrollMagic.Scene({triggerElement:"#tMap1_reserves"}).addTo(e).on("progress",function(t){"FORWARD"===t.scrollDirection?($(".legendCenterText").html("Students were drawn from reserves, tribes, and bands all over Canada, some as far away as <span class='orange'>8000km</span> ."),$(".legendRight").html('<a href="#tMap1_connections"><div class="legendRightContainer"><div class="legendRightInner"><div class="passRight faa-passing animated"><i class="fa fa-arrow-right"></i></div></div></div></a>'),d3.selectAll(".reserveDot").style("display","block").transition().duration(600).ease(d3.easeLinear).style("opacity",.1)):(d3.selectAll(".reserveDot").transition().duration(600).ease(d3.easeLinear).style("opacity",0),d3.selectAll(".reserveDot").transition().delay(600).style("display","none"))}),new ScrollMagic.Scene({triggerElement:"#fromreserves",duration:"100%"}).offset(document.getElementById("fromreserves").offsetHeight/2+"px").addTo(e).on("enter",function(t){var e=t.scrollDirection;mapStatus="FORWARD"===e?"reserves":"zoomedOut"})})}function rightBarOut(t){setTimeout(function(){rightBar=!0,rightBarCurrent=!0},500);var e=t.latitude,r=t.longitude;rightBarData(t),d3.select("#rightBar").classed("rightBarOut",!0);var a=window.innerWidth/2;d3.select(".map").style("transform","translate(-25%,0)"),map.flyTo({center:[r,e],zoom:10,bearing:0,speed:1,curve:1,easing:function(t){return t}}),""===t.listConnections||(d3.selectAll(t.class).classed("reserveDot",!1).classed("connection",!1),d3.selectAll(t.class).style("opacity",".6"))}function rightBarData(t){d3.selectAll(".rRemove").remove();var e=t;d3.json("js/data/schools/"+t.schoolID+".json",function(e){function r(){var t=A.invert(d3.mouse(this)[0]);t>=p-.5?(ft=x(g,t,0),d0=g[ft],d1=g[ft],d=t-d0.year>d1.date-t?d1:d0):(ft=x(g,t,0),d0=g[ft-1],d1=g[ft],d=t-d0.year>d1.date-t?d1:d0),R.select("circle.y").attr("transform","translate("+A(d.year)+","+T(d.number)+")"),R.select(".x").attr("transform","translate("+A(d.year)+","+T(d.number)+")").attr("y2",m-T(d.number));var e=T(d.number)-35;D.style("transform","translate("+A(d.year)+"px ,"+e+"px)").html("<div class='lTip'>"+d.number+"</div>");var r=500,a=30,n=document.getElementById("rTimelineContainer"),o=zenscroll.createScroller(n,500,30),s=document.getElementById("rTLC-"+d.year);o.center(s)}function a(t){Q.hide,V.style("display","flex"),""!=t.agressor&&""!=t.victim?V.append("div").attr("class","lbRemove").html("<div class='lbType'>"+Math.floor(t.date)+": "+t.type.replace("incident","Other Incident").replace("sexual","Sexual Assault Report").replace("physical","Physical Assault Report").replace("policy","Policy Report").replace("health","Health/Medical Issue").replace("program","Programming Report").replace("report","Other Report")+"</div><br><div class='lbBetween'> between "+t.agressor+" and "+t.victim+"</div><br><div class='lbNotes'>"+t.notes.replace(/<br>/g,"<br><br>")+"</div><div class='lbRef'> References:"+t.ref+"</div>"):V.append("div").attr("class","lbRemove").html("<div class='lbType'>"+Math.floor(t.date)+": "+t.type.replace("incident","Other Incident").replace("sexual","Sexual Assault Report").replace("physical","Physical Assault Report").replace("policy","Policy Report").replace("health","Health/Medical Issue").replace("program","Programming Report").replace("report","Other Report")+"</div><br><div class='lbNotes'>"+t.notes.replace(/<br>/g,"<br><br>")+"</div><div class='lbRef'>References: "+t.ref+"</div>")}function n(){V.style("display","none"),d3.selectAll(".lbRemove").remove()}var o=d3.select("#rTitle").append("h2").attr("class","rRemove").html(e.name.replace("IRS","Indian Residential School").replace("RS","Residential School"));d3.selectAll("#rBG").style("background-image","url('/images/schoolPhotos/"+t.schoolID+".jpg')");var s=d3.select("#rSub").append("p").attr("class","rRemove").html("Open from <span class='orange'>"+e.startYear+"</span> to <span class='orange'>"+e.endYear+"</span> in <span class='orange'>"+t.placeName+"</span>, <span class='orange'>"+t.province+"</span>."),i=(document.getElementById("rightBar").offsetHeight-document.getElementById("r5").offsetHeight-20-20)/2;d3.selectAll(".r25").style("height",i+"px");var l=e,c=l.startYear,p=l.endYear,g=l.data.enrollment,u=d3.select("#r3svg").append("svg").attr("class","rRemove").attr("id","svgR").style("width",$("#r3svg").width()+"px").style("height",$("#r3svg").height()+"px"),y={top:5,right:10,bottom:0,left:80},h=$("#r3svg").width()-y.left-y.right,m=$("#r3svg").height()-y.top-y.bottom,f=m/2,v=u.append("g").attr("transform","translate("+y.left+","+y.top+")"),x=d3.bisector(function(t){return t.year>=p-.5?t.year:t.year-.5}).left,R=u.append("g").style("display","none").attr("transform","translate("+y.left+","+y.top+")"),A=d3.scaleLinear().range([0,h]).domain([c,p]),T=d3.scaleLinear().range([f,0]).domain([0,300]),L=v.append("g").attr("id","xAxis").style("transform","translate(0, -"+f+"px)"),w=v.append("g").attr("id","yAxis").style("transform","translate(0, 0)");L.attr("class","xAxis axis").call(d3.axisBottom(A).tickFormat(d3.format("d")).tickSizeInner(-m));var b=m-8,I=f-15;L.style("transform","translate(0px, "+b+"px)"),d3.select(".xAxis path").style("transform","translate(0px, 0px)"),d3.selectAll(".xAxis text").style("transform","translate(0px, -"+I+"px)"),w.attr("class","yAxis axis").call(d3.axisLeft(T).ticks(5).tickSizeInner(-h));var k=d3.line().curve(d3.curveStep).x(function(t){return A(t.year)}).y(function(t){return T(t.number)}),j=v.append("svg:path").attr("id","chart").attr("d",k(g)).attr("stroke",orange).attr("stroke-width",2).attr("fill","none").style("transform","translate(0,0px)"),P=v.append("text").attr("class","enrolUnavailable").attr("text-anchor","middle").attr("x",h/2).attr("y",f/2).attr("dy","5px").style("display","block").text("Enrolment Levels Unavailable");g.length>0&&P.style("display","none"),R.append("circle").attr("class","y").style("fill",orange).style("stroke","none").attr("r",4),R.append("line").attr("class","x").style("stroke",orange).attr("y1",0).attr("y2",m);var S=v.append("line").attr("id","vLine").attr("stroke",mediumGray).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",m);u.append("rect").attr("width",h).attr("height",f).style("fill","none").style("pointer-events","all").attr("transform","translate("+y.left+","+y.top+")").on("mouseover",function(){R.style("display",null)}).on("mouseout",function(){}).on("mousemove",r);var D=d3.select("#r3svg").append("div").attr("class","lineTooltip lbRemove"),M=l.data.management,M=l.data.management,C=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return"<span class='sMorgName'>"+t.orgName+"</span><br><span class='sMyear'>"+t.startYear+"-"+t.endYear+"</span><br><span class='sMtype'>"+t.type.toString().replace(/,/g,", ")+"</span>"});u.call(C);var B=v.append("line").attr("class","lineAI").attr("x1",0).attr("x2",h).attr("y1",f+32).attr("y2",f+32),O=v.append("line").attr("class","lineAI").attr("x1",0).attr("x2",h).attr("y1",f+50).attr("y2",f+50),E=v.append("line").attr("class","lineAI").attr("x1",0).attr("x2",h).attr("y1",f+65).attr("y2",f+65),H=v.append("line").attr("class","lineAI").attr("x1",0).attr("x2",h).attr("y1",f+80).attr("y2",f+80),z=v.append("line").attr("class","lineAI").attr("x1",0).attr("x2",h).attr("y1",f+95).attr("y2",f+95),W=v.append("line").attr("class","lineAI").attr("x1",0).attr("x2",h).attr("y1",f+110).attr("y2",f+110),W=v.append("line").attr("class","lineAI").attr("x1",0).attr("x2",h).attr("y1",f+125).attr("y2",f+125),_=v.append("line").attr("class","lineAI").attr("x1",0).attr("x2",h).attr("y1",f+140).attr("y2",f+140),F=v.selectAll(".sMbars").data(M).enter().append("line",".sMbars").attr("class","sMbar").attr("x1",function(t){return A(t.startYear)}).attr("x2",function(t){return A(t.endYear)-5}).attr("y1",f+32).attr("y2",f+32).on("mousemove",C.show).on("mouseout",C.hide),Y=v.selectAll(".sMlabels").data(M).enter().append("text",".sMlabels").attr("class","sMlabel").attr("x",function(t){return A(t.startYear)}).attr("dy",11).attr("dx",3).attr("y",f+25).text(function(t){return t.org}),q=l.data.additionalInformation.filter(function(t){return"sexual"===t.type}),N=l.data.additionalInformation.filter(function(t){return"health"===t.type}),G=l.data.additionalInformation.filter(function(t){return"physical"===t.type}),U=l.data.additionalInformation.filter(function(t){return"incident"===t.type}),Z=l.data.additionalInformation.filter(function(t){return"policy"===t.type}),J=l.data.additionalInformation.filter(function(t){return"program"===t.type}),K=l.data.additionalInformation.filter(function(t){return"other"===t.type}),Q=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t.notes.length>300?"<span class='AItip-h'><strong>"+t.date+"</strong> "+t.type.replace("incident","Other Incident").replace("sexual","Sexual Assault Report").replace("physical","Physical Assault Report").replace("policy","Policy Report").replace("health","Health/Medical Issue").replace("program","Programming Report").replace("report","Other Report")+"</span><br><span class='AItip-p'>"+t.notes.substring(0,250)+"...</span><br><span class='AItip-more'>Click to read more.</span>":"<span class='AItip-h'><strong>"+t.date+"</strong> "+t.type.replace("incident","Other Incident").replace("sexual","Sexual Assault Report").replace("physical","Physical Assault Report").replace("policy","Policy Report").replace("health","Health/Medical Issue").replace("program","Programming Report").replace("report","Other Report")+"</span><br><span class='AItip-p'>"+t.notes+"</span>"});u.call(Q);var V=d3.select("#rightBar").append("div").attr("class","lightbox").style("display","none");V.on("click",function(){n()}),V.append("div").html("<div class='lbExit'><i class='fa fa-times' aria-hidden='true' onclick='lbclick()'></i></div>");var X=v.append("text").attr("class","lEnrolment").attr("x",-f/2).attr("dy",2).attr("y",-40).attr("text-anchor","middle").text("Average Enrolment"),tt=v.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",f+35).attr("text-anchor","end").text("Management"),et=v.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",f+50).attr("text-anchor","end").text("Sexual Abuse"),rt=v.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",f+65).attr("text-anchor","end").text("Physical Abuse"),at=v.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",f+80).attr("text-anchor","end").text("Other Incidents"),nt=v.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",f+95).attr("text-anchor","end").text("Health/Medical"),ot=v.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",f+110).attr("text-anchor","end").text("Policy"),st=v.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",f+125).attr("text-anchor","end").text("Programming"),it=v.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",f+140).attr("text-anchor","end").text("Other Reports"),lt=v.selectAll(".AIsexual").data(q).enter().append("circle",".AIsexual").attr("class","AIsexual AIcircle").attr("cx",function(t){return A(t.date)}).attr("cy",f+50).attr("r",4).on("mousemove",Q.show).on("click",function(t){a(t)}).on("mouseout",Q.hide),ct=v.selectAll(".AIphysical").data(G).enter().append("circle",".AIphysical").attr("class","AIphysical AIcircle").attr("cx",function(t){return A(t.date)}).attr("cy",f+65).attr("r",4).on("mousemove",Q.show).on("click",function(t){a(t)}).on("mouseout",Q.hide),dt=v.selectAll(".AIincident").data(U).enter().append("circle",".AIincident").attr("class","AIincident AIcircle").attr("cx",function(t){return A(t.date)}).attr("cy",f+80).attr("r",4).on("mousemove",Q.show).on("click",function(t){a(t)}).on("mouseout",Q.hide),pt=v.selectAll(".AIhealth").data(N).enter().append("circle",".AIhealth").attr("class","AIhealth AIcircle").attr("cx",function(t){return A(t.date)}).attr("cy",f+95).attr("r",4).on("mousemove",Q.show).on("click",function(t){a(t)}).on("mouseout",Q.hide),gt=v.selectAll(".AIpolicy").data(Z).enter().append("circle",".AIpolicy").attr("class","AIpolicy AIcircle").attr("cx",function(t){return A(t.date)}).attr("cy",f+110).attr("r",4).on("mousemove",Q.show).on("click",function(t){a(t)}).on("mouseout",Q.hide),ut=v.selectAll(".AIprogram").data(J).enter().append("circle",".AIprogram").attr("class","AIprogram AIcircle").attr("cx",function(t){return A(t.date)}).attr("cy",f+125).attr("r",4).on("mousemove",Q.show).on("mouseout",Q.hide),yt=v.selectAll(".AIother").data(K).enter().append("circle",".AIother").attr("class","AIother AIcircle").attr("cx",function(t){return A(t.date)}).attr("cy",f+140).attr("r",4).on("mousemove",Q.show).on("click",function(t){a(t)}).on("mouseout",Q.hide),ht=l.data.chronoHistory,mt=d3.select("#rTimeline").append("div").attr("class","rTimelineContainer rRemove").attr("id","rTimelineContainer");d3.select(".rTimelineContainer").style("height",i+"px");for(var ft=0;ft<ht.length;ft++){var vt=ht[ft].date;mt.append("div").attr("class","rTimelineEach").attr("id","rTLC-"+vt).style("height",i+"px");var xt=A(vt),Rt=new TweenMax.to("#vLine",.25,{css:{transform:"translate("+xt+"px, 0)"}}),At=new ScrollMagic.Scene({triggerElement:"#rTLC-"+vt}).triggerHook(.75).setTween(Rt).addTo(controller)}for(var Tt=0;Tt<ht.length;Tt++)for(var Lt=d3.select("#rTLC-"+ht[Tt].date).append("div").attr("class","rTL").attr("id","rTL-"+ht[Tt].date).html("<br>").html("<div class='rTLy'>"+ht[Tt].date+"</div>"),wt=0;wt<ht[Tt].desc.length;wt++)Lt.append("div").attr("class","rTLd").html(ht[Tt].desc[wt])})}function rightBarBack(){mapStatus="zoomedOut",d3.select("#rightBar").classed("rightBarOut",!1),d3.select(".map").style("transform","translate(0,0)"),map.flyTo({center:[-100,58],zoom:4,bearing:0,speed:2,curve:1,easing:function(t){return t}}),d3.selectAll(".reserveDot").style("display","block").transition().duration(600).ease(d3.easeLinear).style("opacity",.1),d3.selectAll(".schoolMarker").transition().duration(600).ease(d3.easeLinear).style("opacity",1),d3.selectAll(".schoolLabel").style("opacity","0"),rightBar=!1}function destroyTrigs(t){d3.selectAll(".sTremove").remove(),storyTrig0.refresh(),t>0&&storyTrig1.refresh(),t>2&&storyTrig2.refresh(),t>3&&storyTrig3.refresh(),t>4&&storyTrig4.refresh(),t>5&&storyTrig5.refresh(),sTRslide_out_s.refresh(),sTRslide_back_s.refresh()}function drawStory(t){d3.select(".storyTime").remove(),d3.selectAll(".sTremove").remove(),d3.json("js/data/stories/stories.json",function(e){function r(){d3ProjectionRight=getD3Right(),pathRight.projection(d3ProjectionRight),_.attr("cx",function(t){return d3ProjectionRight([t.lng,t.lat])[0]}).attr("cy",function(t){return d3ProjectionRight([t.lng,t.lat])[1]}),F.attr("cx",function(t){return d3ProjectionRight([story.latLng.lng,story.latLng.lat])[0]}).attr("cy",function(t){return d3ProjectionRight([story.latLng.lng,story.latLng.lat])[1]}),Y.attr("x",function(t){return d3ProjectionRight([t.lng,t.lat])[0]}).attr("y",function(t){return d3ProjectionRight([t.lng,t.lat])[1]}).text(function(t){return t.placeName})}function a(t){function e(){d3ProjectionRight=getD3Right(),pathRight.projection(d3ProjectionRight),l.length>0&&(d.attr("x1",function(t){return d3ProjectionRight([l[0].sLng,l[0].sLat])[0]}).attr("y1",function(t){return d3ProjectionRight([l[0].sLng,l[0].sLat])[1]}),t<1?d.attr("x2",function(t){return d3ProjectionRight([l[0].sLng,l[0].sLat])[0]}).attr("y2",function(t){return d3ProjectionRight([l[0].sLng,l[0].sLat])[1]}).transition().duration(500).style("opacity",1):1===t&&d.transition().duration(1e3).attr("x2",function(t){return d3ProjectionRight([l[0].eLng,l[0].eLat])[0]}).attr("y2",function(t){return d3ProjectionRight([l[0].eLng,l[0].eLat])[1]}).transition().duration(500).style("opacity",0)),l.length>1&&(p.attr("x1",function(t){return d3ProjectionRight([l[1].sLng,l[1].sLat])[0]}).attr("y1",function(t){return d3ProjectionRight([l[1].sLng,l[1].sLat])[1]}),t<2?p.attr("x2",function(t){return d3ProjectionRight([l[1].sLng,l[1].sLat])[0]}).attr("y2",function(t){return d3ProjectionRight([l[1].sLng,l[1].sLat])[1]}):2===t&&p.transition().duration(1e3).attr("x2",function(t){return d3ProjectionRight([l[1].eLng,l[1].eLat])[0]}).attr("y2",function(t){return d3ProjectionRight([l[1].eLng,l[1].eLat])[1]}).transition().duration(500).style("opacity",0)),l.length>2&&(g.attr("x1",function(t){return d3ProjectionRight([l[2].sLng,l[2].sLat])[0]}).attr("y1",function(t){return d3ProjectionRight([l[2].sLng,l[2].sLat])[1]}),t<3?g.attr("x2",function(t){return d3ProjectionRight([l[2].sLng,l[2].sLat])[0]}).attr("y2",function(t){return d3ProjectionRight([l[2].sLng,l[2].sLat])[1]}):3===t&&g.transition().duration(1e3).attr("x2",function(t){return d3ProjectionRight([l[2].eLng,l[2].eLat])[0]}).attr("y2",function(t){return d3ProjectionRight([l[2].eLng,l[2].eLat])[1]}).transition().duration(500).style("opacity",0)),l.length>3&&(u.attr("x1",function(t){return d3ProjectionRight([l[3].sLng,l[3].sLat])[0]}).attr("y1",function(t){return d3ProjectionRight([l[3].sLng,l[3].sLat])[1]}),t<4?u.attr("x2",function(t){return d3ProjectionRight([l[3].sLng,l[3].sLat])[0]}).attr("y2",function(t){return d3ProjectionRight([l[3].sLng,l[3].sLat])[1]}):4===t&&u.transition().duration(1e3).attr("x2",function(t){return d3ProjectionRight([l[3].eLng,l[3].eLat])[0]}).attr("y2",function(t){return d3ProjectionRight([l[3].eLng,l[3].eLat])[1]}).transition().duration(500).style("opacity",0)),l.length>4&&(y.attr("x1",function(t){return d3ProjectionRight([l[4].sLng,l[4].sLat])[0]}).attr("y1",function(t){return d3ProjectionRight([l[4].sLng,l[4].sLat])[1]}),t<5?y.attr("x2",function(t){return d3ProjectionRight([l[4].sLng,l[4].sLat])[0]}).attr("y2",function(t){return d3ProjectionRight([l[4].sLng,l[4].sLat])[1]}):5===t&&y.transition().duration(1e3).attr("x2",function(t){return d3ProjectionRight([l[4].eLng,l[4].eLat])[0]}).attr("y2",function(t){return d3ProjectionRight([l[4].eLng,l[4].eLat])[1]}).transition().duration(500).style("opacity",0))}conRightStatus=t,d3.selectAll(".sTremoveRight").remove();for(var r=t;r<t+1;r++)var a=d3.select(".sTdata").append("div").attr("class","sTremoveRight sTremove sTdataBox").html("<div id='sTdataContainer'></div>"),n=d3.select("#sTdataContainer").append("div").attr("class","sTsection").html(M[r].section),o=d3.select("#sTdataContainer").append("div").attr("class","sTpre").html(M[r].pre),s=d3.select("#sTdataContainer").append("div").attr("class","sTextra").html(M[r].extra);var i=7;59.1140672===M[t].lat&&(i=5),mapR.flyTo({center:[M[t].lng,M[t].lat],zoom:i,bearing:0,speed:1,curve:1,easing:function(t){return t}}),d3ProjectionRight=getD3Right(),pathRight.projection(d3ProjectionRight);var l=story.connections;mapR.on("move",function(){e()}),e()}story=e.stories.filter(function(e){return e.id===t}),story=story[0];var n=new TweenMax.to(".newLegend",.25,{y:"-100%"}),o=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1,new ScrollMagic.Scene({triggerElement:"#p6"}).setTween(n).addTo(o).on("enter",function(t){"FORWARD"===t.scrollDirection?(status="map",mapStatus="zoomedIn",$(".legendCenterText").html(story.name+" attended <span class='orange'>"+story.school+"</span> in "+story.direction+" "+story.province+"."),$(".legendRight").html('<a href="#tMap1_zo"><div class="legendRightContainer"><div class="legendRightInner"><div class="passRight faa-passing animated"><i class="fa fa-arrow-right"></i></div></div></div></a>')):(status="story",mapStatus="none")});var s=story.name,i=story.bio;storySelected=story.name+" was",pageSix(s);for(var l=$("#storyName").html("<h1 class='sTremove'>"+s+"</h1>"),c=$("#storyBio").html("<p class='sTremove'>"+i+"</p>"),d=gRight.append("line").attr("pointer-events","none").attr("class","sTremove").style("stroke",orange).style("stroke-width",2),p=gRight.append("line").attr("pointer-events","none").attr("class","sTremove").style("stroke",orange).style("stroke-width",2),g=gRight.append("line").attr("pointer-events","none").attr("class","sTremove").style("stroke",orange).style("stroke-width",2),u=gRight.append("line").attr("pointer-events","none").attr("class","sTremove").style("stroke",orange).style("stroke-width",2),y=gRight.append("line").attr("pointer-events","none").attr("class","sTremove").style("stroke",orange).style("stroke-width",2),h=["Bob","Baxter","They","they","we","us","I","I'm","They're","they're","They'll","They'll","I'll","I've","He","He's","He'll","He'd","he","he's","he'll","he'd","She","She's","She'll","She'd","she","she's","she'll","she'd","His","his","Hers","hers","mine","my","Mine","My","Sally","Anthony","Henry","Father","LaSalle","We","We're","We'd","we're","we'd","We'll","we'll","me","Me","our","their","Our","Their","Us","You","You'll","You're","You'd","You've","you","you'll","you're","you'd","you've"],m=["Sioux","Lookout","Anishinaabe","Cree","English","Anglican","Roman","Catholic","York","Landing","Indian","First","Nation","Inuit","Eskimo","Banks","Island","Mission","Tuk","Aklavik","Tuktoyaktuk","Inuvialuktun","Ojibway","white","kids","squaws","neechies","Kenora","Canadiens","Maple","Leafs","Toronto","Meadow","Lake","Bella","Coola","Long","Beach","Sun","Dances","“wâpam","awa”","wâpam","awa","Presbyterian","Christian","Dakota"],f=0;f<story.story.length;f++){var v=d3.select("#storyStories").append("div").attr("class","storyStories sTremove").attr("id","story-"+f).style("height",window.innerHeight+"px"),x=story.story[f].section,R=story.story[f].pre,A=story.story[f].quote,T=RiString(A),L=T.words();pos=T.pos(),v.html("<p class='story-quote'>&ldquo;<span id='story-quote-"+f+"'></span>&rdquo;</p>");for(var w=0;w<L.length;w++)if(-1!==m.indexOf(L[w])&&(pos[w]="orange"),-1!==h.indexOf(L[w])&&(pos[w]="darkGray"),/[,.?\-]/.test(L[w+1]))var b=d3.select("#story-quote-"+f).append("span").attr("id","quote-"+w).attr("class","storiesMediumGray pos-"+pos[w]).html(L[w]);else var b=d3.select("#story-quote-"+f).append("span").attr("id","quote-"+w).attr("class","storiesMediumGray pos-"+pos[w]).html(L[w]+" ")}var I=0,k=1,j=2,P=3,S=4,D=5,M=story.story,C=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1;var B=new ScrollMagic.Scene({triggerElement:"#story-0"}).addTo(C).triggerHook(.75).on("progress",function(t){a((t.scrollDirection,0))});if(M.length>1)var O=new ScrollMagic.Scene({triggerElement:"#story-1"}).addTo(C).triggerHook(.75).on("progress",function(t){a("FORWARD"===t.scrollDirection?1:0)});if(M.length>2)var E=new ScrollMagic.Scene({triggerElement:"#story-2"}).addTo(C).triggerHook(.75).on("progress",function(t){a("FORWARD"===t.scrollDirection?2:1)});if(M.length>3)var H=new ScrollMagic.Scene({triggerElement:"#story-3"}).addTo(C).triggerHook(.75).on("progress",function(t){a("FORWARD"===t.scrollDirection?3:2)});if(M.length>4)var z=new ScrollMagic.Scene({triggerElement:"#story-4"}).addTo(C).triggerHook(.75).on("progress",function(t){a("FORWARD"===t.scrollDirection?4:3)});if(M.length>5)var W=new ScrollMagic.Scene({triggerElement:"#story-5"}).addTo(C).triggerHook(.75).on("progress",function(t){a("FORWARD"===t.scrollDirection?5:4)});var _=gRight.selectAll(".sCircleRight").data(M).enter().append("circle",".sCircleRight").attr("pointer-events","visible").attr("class","sTremove").style("stroke","none").style("opacity",1).style("fill",orange).attr("r",5),F=gRight.append("circle",".sCircleRightMain").attr("pointer-events","visible").attr("class","sTremove").style("stroke","none").style("opacity",1).style("fill",darkGray).attr("r",7.5),Y=gRight.selectAll(".sLabelsRight").data(M).enter().append("text",".sLabelsRight").attr("class","sTremove").attr("pointer-events","visible").attr("class","labelsRight").attr("text-anchor","middle").attr("dy",20).style("stroke","none").style("opacity",1);mapR.on("viewreset",function(){r()}),mapR.on("move",function(){r()}),r(),$(".sTname").html("<h1 class='sTremove'>"+story.name+"</h1>"),!0===story.picture&&$(".sTimage").css("background","linear-gradient(rgba(241, 90, 36, 0.25),rgba(241, 90, 36, 0.25)), url('js/data/stories/images/"+story.id+".png'), rgb(241, 90, 36)").css("background-size","3.5em").css("background-position","center"),$(".sTsource").html("<div class='sTsources sTremove'><div>Quotes, background, and images sourced from <em>The Survivors Speak: a Report of the Truth and Reconciliation Commision of Canada</em><sup>1,2</sup>.</div><div class='footnote'><sup>1</sup> Truth and Reconciliation Canada. The survivors speak: a report of the Truth and Reconciliation Commission of Canada. Winnipeg: Truth and Reconciliation Commission of Canada., Publishers, 2015.<br><sup>2</sup> "+story.source+"</div></div>");var q=new TweenMax.to(".sTslide",.25,{x:"-200%"}),N=new TweenMax.to(".storyNarrow",.25,{css:{padding:"0 100px 0 100px"}});sTRslide_out_s=new ScrollMagic.Scene({triggerElement:"#p55"}).triggerHook("onEnter").setTween(q).addTo(controller),sTRslide_out_s.on("progress",function(t){var e=t.scrollDirection});var G=new TweenMax.to(".sTslide",.25,{x:"200%"});sTRslide_back_s=new ScrollMagic.Scene({triggerElement:"#p59"}).triggerHook("onEnter").setTween(G).addTo(controller)})}function mapLegend(t,e,r,a,n){var o=$(".newLegend")}var storyID="ekematch",orange="#f15a24",mediumGray="#999",darkGray="#333",rightBar=!1,status="begin",mapStatus="none",drawn=!1,conRightStatus=0;window.onload=drawStory(storyID);var controller=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1;var map1=d3.select("#map1_cont").append("div").attr("class","map").attr("id","map");d3.select("#map").style("height",window.innerHeight+"px").style("width",window.innerWidth+"px"),mapboxgl.accessToken="pk.eyJ1Ijoic3ZpY2thcnMiLCJhIjoiY2l1aW5saDhkMDAwMTNvbDdmcTlncnp1cyJ9.wIpJKF-DW1C2uPgKnUtNWg";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/svickars/cj15o81vo00212rqu9mw0wgkp",center:[-92.01173055555556,50.12052777777778],zoom:9}),mapR=new mapboxgl.Map({container:"sTmap",style:"mapbox://styles/svickars/cj15o81vo00212rqu9mw0wgkp",center:[-103.5334127,59.1140672],zoom:3.5});map.scrollZoom.disable(),mapR.scrollZoom.disable(),map.dragRotate.disable(),mapR.dragRotate.disable(),map.addControl(new mapboxgl.Navigation);var map1_p=new ScrollMagic.Scene({triggerElement:"#tMap1_p",duration:"800%"}).triggerHook("onLeave").setPin("#map1_cont").addTo(controller);map1_p.on("enter",function(t){var e=t.scrollDirection;status="FORWARD"===e?"map":"story"});var container=map.getCanvasContainer(),containerRight=mapR.getCanvasContainer(),svg=d3.select(container).append("svg"),svgRight=d3.select(containerRight).append("svg"),g=svg.append("g"),gRight=svgRight.append("g"),d3Projection=getD3(),d3ProjectionRight=getD3Right(),path=d3.geoPath(),pathRight=d3.geoPath();d3.json("js/data/locations.json",function(t){function e(){d3Projection=getD3(),path.projection(d3Projection),y.attr("cx",function(t){return d3Projection([t.longitude,t.latitude])[0]}).attr("cy",function(t){return d3Projection([t.longitude,t.latitude])[1]}),d.attr("x",function(t){return d3Projection([t.longitude,t.latitude])[0]}).attr("y",function(t){return d3Projection([t.longitude,t.latitude])[1]}),c.attr("x",function(t){return d3Projection([t.longitude,t.latitude])[0]}).attr("y",function(t){return d3Projection([t.longitude,t.latitude])[1]}),u.attr("x",function(t){return d3Projection([t.longitude,t.latitude])[0]}).attr("y",function(t){return d3Projection([t.longitude,t.latitude])[1]}),p.attr("x",function(t){return d3Projection([t.longitude,t.latitude])[0]}).attr("y",function(t){return d3Projection([t.longitude,t.latitude])[1]}),s.attr("x",function(t){return d3Projection([t.longitude,t.latitude])[0]}).attr("y",function(t){return d3Projection([t.longitude,t.latitude])[1]}),i.attr("cx",function(t){return d3Projection([t.lng,t.lat])[0]}).attr("cy",function(t){return d3Projection([t.lng,t.lat])[1]}),l.attr("x",function(t){return d3Projection([t.lng,t.lat])[0]}).attr("y",function(t){return d3Projection([t.lng,t.lat])[1]}),y.on("mouseover",r).on("click",function(t){rightBarOut(t),d3.event.stopPropagation()}).on("mouseout",n),i.on("mouseover",a).on("mouseout",o)}function r(t){d3.select("#dot-"+t.schoolID).classed("schoolMarker",!1),d3.selectAll(".schoolMarker").style("opacity",".25"),d3.select("#dot-"+t.schoolID).style("fill","#333").style("opacity",1),"zoomedIn"!=mapStatus&&d3.selectAll("#sTip-"+t.schoolID).style("opacity","1.0"),""===t.listConnections||(d3.selectAll(t.class).classed("reserveDot",!1).classed("connection",!1),d3.selectAll(t.class).style("opacity",".6")),d3.selectAll(".reserveDot").style("opacity",".05"),d3.selectAll(".connection").style("opacity",".05")}function a(t){d3.select("#rDot-"+t.id).classed("reserveDot",!1),d3.selectAll(".reserveDot").style("opacity",".025").style("fill","#333"),"zoomedIn"!=mapStatus&&d3.selectAll("#rTip-"+t.id).style("opacity","1.0"),""===t.listConnections||(d3.selectAll(t.class).classed("schoolMarker",!1).classed("connection",!1),d3.selectAll(t.class).style("opacity","1"),d3.select("#rDot-"+t.id).style("opacity",.25)),d3.selectAll(".schoolMarker").style("opacity",".25"),d3.selectAll(".connection").style("opacity",".05")}function n(t){d3.selectAll(".dot").classed("schoolMarker",!0),d3.selectAll(".schoolMarker").style("fill",orange).style("opacity","1"),d3.selectAll("#sTip-"+t.schoolID).style("opacity","0"),
d3.selectAll(".sTooltip").style("opacity","0"),d3.selectAll(".sTooltip2").style("opacity","0"),d3.selectAll(".rDot").classed("reserveDot",!0),d3.selectAll(".reserveDot").style("opacity",".1"),d3.selectAll(".conn").classed("connection",!0),d3.selectAll(".connection").style("opacity","0.25")}function o(t){d3.selectAll(".rDot").classed("reserveDot",!0),d3.selectAll(".reserveDot").style("opacity",".1"),d3.selectAll(".dot").classed("schoolMarker",!0),d3.selectAll(".schoolMarker").style("opacity","1"),d3.selectAll(".conn").classed("connection",!0),d3.selectAll(".connection").style("opacity","0.25"),d3.selectAll("#rTip-"+t.id).style("opacity","0"),d3.selectAll(".rTooltip").style("opacity","0")}var s=g.selectAll("text").data(t.schools).enter().append("text").attr("class","label schoolLabel").attr("id",function(t){return"label-"+t.schoolID}).attr("pointer-events","none").attr("dy","6px").attr("dx","10px").text(function(t){return t.locationName+" "+t.title}),i=g.selectAll(".rDot").data(t.reservations).enter().append("circle",".rDot").attr("pointer-events","visible").attr("class",function(t){return"rDot reserveDot "+t.listConnections}).attr("id",function(t){return"rDot-"+t.id}).style("stroke","none").style("display","none").style("opacity","0").style("fill","#333").attr("r",15),l=g.selectAll(".rTip").data(t.reservations).enter().append("text",".rtip").attr("class","rTooltip").attr("id",function(t){return"rTip-"+t.id}).attr("pointer-events","none").attr("dx","20px").attr("dy","5px").text(function(t){return t.reserve}),c=g.selectAll(".sTipB").data(t.schools).enter().append("text",".stipB").attr("class","sTooltipB").attr("id",function(t){return"sTip-"+t.schoolID}).attr("pointer-events","none").attr("dx","9px").attr("dy","5px").text(function(t){return t.locationName+" "+t.title}),d=g.selectAll(".sTip").data(t.schools).enter().append("text",".stip").attr("class","sTooltip").attr("id",function(t){return"sTip-"+t.schoolID}).attr("pointer-events","none").attr("dx","9px").attr("dy","5px").text(function(t){return t.locationName+" "+t.title}),p=g.selectAll(".sTip2B").data(t.schools).enter().append("text",".stip2B").attr("class","sTooltip2B").attr("id",function(t){return"sTip-"+t.schoolID}).attr("pointer-events","none").attr("dx","9px").attr("dy","19px").text(function(t){return t.start+" - "+t.end}),u=g.selectAll(".sTip2").data(t.schools).enter().append("text",".stip2").attr("class","sTooltip2").attr("id",function(t){return"sTip-"+t.schoolID}).attr("pointer-events","none").attr("dx","9px").attr("dy","19px").text(function(t){return t.start+" - "+t.end}),y=g.selectAll(".sCircle").data(t.schools).enter().append("circle",".sCircle").attr("class",function(t){return"schoolMarker dot "+t.listConnections}).attr("pointer-events","visible").attr("id",function(t){return"dot-"+t.schoolID}).style("stroke","none").style("opacity",1).style("fill",orange).attr("r",5);map.on("viewreset",function(){e()}),map.on("move",function(){e()}),e()}),d3.json("js/data/connections.json",function(t){function e(){d3Projection=getD3(),path.projection(d3Projection),!1===drawn?r.attr("x1",function(t){return d3Projection([t.sLng,t.sLat])[0]}).attr("y1",function(t){return d3Projection([t.sLng,t.sLat])[1]}).attr("x2",function(t){return d3Projection([t.sLng,t.sLat])[0]}).attr("y2",function(t){return d3Projection([t.sLng,t.sLat])[1]}):r.attr("x1",function(t){return d3Projection([t.sLng,t.sLat])[0]}).attr("y1",function(t){return d3Projection([t.sLng,t.sLat])[1]}).attr("x2",function(t){return d3Projection([t.eLng,t.eLat])[0]}).attr("y2",function(t){return d3Projection([t.eLng,t.eLat])[1]})}var r=g.selectAll("line").data(t).enter().append("line").attr("class",function(t){return"connection conn "+t.id}).attr("id",function(t){return"conn-"+t.id}).style("stroke",orange).style("opacity",.25);new ScrollMagic.Scene({triggerElement:"#tMap1_connections"}).addTo(controller).on("progress",function(t){"FORWARD"===t.scrollDirection?($(".legendCenterText").html("Explore by <span class='orange'>panning</span> with your mouse or <span class='orange'>zooming</span> with the controls in the top right. <span class='orange'>Click</span> or <span class='orange'>hover</span> on school locations to see more.<BR><span class='scrollUp'>Scroll up to go back a step</span>"),$(".legendRight").html('<a href="#p1"><div class="legendRightContainer"><div class="legendRightInner"><div class="passRight faa-pulse faa-slow animated"><i class="fa fa-fast-backward" style="opacity: .5"></i></div></div></div></a>'),drawn=!0,mapStatus="connections",r.transition().duration(1500).attr("x2",function(t){return d3Projection([t.eLng,t.eLat])[0]}).attr("y2",function(t){return d3Projection([t.eLng,t.eLat])[1]})):(drawn=!1,mapStatus="reserves",r.transition().duration(1500).attr("x2",function(t){return d3Projection([t.sLng,t.sLat])[0]}).attr("y2",function(t){return d3Projection([t.sLng,t.sLat])[1]}))}),map.on("viewreset",function(){e()}),map.on("move",function(){e()}),map.on("rotate",function(){e()}),e()}),map.on("click",function(t){!0===rightBar&&rightBarBack(t)}),jQuery("#stories-select").draggable({axis:"x",cursor:"move",containment:"stories"});var storiesSelectScroll=(new TimelineMax).to("#stories-select",1,{x:"-50%",delay:.25}),p4pin=new ScrollMagic.Scene({triggerElement:"#p4",triggerHook:"onLeave",duration:"200%"}).setPin("#p4").setTween(storiesSelectScroll).addTo(controller);p4pin.on("progress",function(t){var e=t.scrollDirection;status="FORWARD"===e?"story":"begin"}),d3.json("js/data/stories/stories.json",function(t){for(var e=0;e<t.stories.length;e++){var r=d3.select("#stories-select").append("div").attr("class","story-option-container").attr("id",t.stories[e].id).on("click",function(t,e){p4pin.destroy(),storyID=d3.select(this).attr("id"),d3.selectAll(".story-option-container").transition().duration(200).ease(d3.easeLinear).style("opacity",.1),d3.select("#"+storyID).transition().duration(200).ease(d3.easeLinear).style("opacity",1),drawStory(storyID)}),a=d3.select("#"+t.stories[e].id).append("div").attr("class","story-option-circle").attr("id","story-option"+e);!0===t.stories[e].picture&&a.style("background","linear-gradient(rgba(241, 90, 36, 0.25),rgba(241, 90, 36, 0.25)), url('js/data/stories/images/"+t.stories[e].id+".png'), rgb(241, 90, 36)").style("background-size","10em");d3.select("#"+t.stories[e].id).append("div").attr("class","story-label").html("<p class='story-option-name'>"+t.stories[e].name+"</p><p class='story-option-quote'>&ldquo;"+t.stories[e].pull+"&rdquo;</p>")}});