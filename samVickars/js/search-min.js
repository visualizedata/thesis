function updateHaystack(e){haystack=[],d3.json("js/data/search_terms.json",function(t){"Stories"===e?t=t.filter(function(e){return"story"===e.type}):"Schools"===e?t=t.filter(function(e){return"school"===e.type}):"Reservations, Tribes, and Bands"===e&&(t=t.filter(function(e){return"reservation"===e.type}));for(var s=0;s<t.length;s++)haystack.push(t[s])})}function runSearch(e){var t=$(".cd-search-suggestions"),s=$(".o1"),o=$(".o2"),i=$(".o3"),n=$(".o1A"),a=$(".o2A"),l=$(".o3A"),c=$(".o1h"),r=$(".o2h"),d=$(".o3h"),p=$(".o1Sh"),h=$(".o2Sh"),y=$(".o3Sh"),u=$(".o1I"),m=$(".o2I"),g=$(".o3I"),v=$(".o1Info"),f=$(".o2Info"),S=$(".o3Info");t.removeClass("cd-search-suggestionsInvisible"),t.addClass("cd-search-suggestionsVisible");var T={shouldSort:!0,includeScore:!0,threshold:.6,location:0,distance:100,maxPatternLength:32,minMatchCharLength:3,keys:["name","location"]},k=new Fuse(haystack,T),A=k.search(e),b,C,w;"school"===A[0].type&&"TRUE"===A[0].photo?b="images/schoolPhotos/"+A[0].id+".jpg":"story"===A[0].type&&"TRUE"===A[0].photo&&(b="js/data/stories/images/"+A[0].id+".png"),"school"===A[1].type&&"TRUE"===A[1].photo?C="images/schoolPhotos/"+A[1].id+".jpg":"story"===A[1].type&&"TRUE"===A[1].photo&&(C="js/data/stories/images/"+A[1].id+".png"),"school"===A[2].type&&"TRUE"===A[2].photo?w="images/schoolPhotos/"+A[2].id+".jpg":"story"===A[2].type&&"TRUE"===A[2].photo&&(w="js/data/stories/images/"+A[2].id+".png");var I=[A[0].id,A[0].name,A[0].type,A[0].lat,A[0].lng],x=[A[1].id,A[1].name,A[1].type,A[1].lat,A[1].lng],E=[A[2].id,A[2].name,A[2].type,A[2].lat,A[2].lng];c.text(A[0].name),p.text(A[0].type.replace("story","Residential School Survivor").replace("school","Residential School").replace("reservation","Reserve/Band/Tribe")),u.html("<div class='oI' style='background-image: url("+b+")'></div>"),v.text(A[0].location),n.text(I),r.text(A[1].name),h.text(A[1].type.replace("story","Residential School Survivor").replace("school","Residential School").replace("reservation","Reserve/Band/Tribe")),m.html("<div class='oI' style='background-image: url("+C+")'></div>"),f.text(A[1].location),a.text(x),d.text(A[2].name),y.text(A[2].type.replace("story","Residential School Survivor").replace("school","Residential School").replace("reservation","Reserve/Band/Tribe")),g.html("<div class='oI' style='background-image: url("+w+")'></div>"),S.text(A[2].location),l.text(E)}function optionClick(e,t,s,o,i){if("story"===s){drawStory(e),pageSix(t);var n=document.getElementById("p5");zenscroll.to(n)}else if("none"===mapStatus||"zoomedIn"===mapStatus){map.flyTo({center:[i,o],zoom:10,bearing:0,speed:100,curve:1,easing:function(e){return e}}),"school"===s?sSearch(e):rSearch(e);var n=document.getElementById("p6");zenscroll.to(n)}else if("zoomedOut"===mapStatus){"school"===s?sSearch(e):rSearch(e);var n=document.getElementById("tMap1_reserves");zenscroll.to(n)}else if("reserves"===mapStatus){"school"===s?sSearch(e):rSearch(e);var n=document.getElementById("tMap1_connections");zenscroll.to(n)}else if("connections"===mapStatus){"school"===s?sSearch(e):rSearch(e);var n=document.getElementById("tMap1_connections");zenscroll.to(n)}}function rSearch(e){d3.selectAll(".rDot").style("opacity",".025").style("fill","#333"),d3.select("#rDot-"+e).style("opacity",".75").style("fill",orange),d3.selectAll(".rTooltip").style("opacity","0"),d3.selectAll(".dot").style("opacity",".25").style("fill",orange),d3.selectAll(".conn").style("opacity",".05"),d3.selectAll(".sTooltip").style("opacity",0),d3.selectAll(".sTooltipB").style("opacity",0),d3.selectAll(".sTooltip2").style("opacity",0),d3.selectAll(".sTooltip2B").style("opacity",0),d3.selectAll("#sTip-"+e).style("opacity",0),d3.select("#l2").transition().duration(500).ease(d3.easeLinear).style("opacity",.75),d3.select(".legendIn-bottom").transition().delay(500).duration(500).ease(d3.easeLinear).style("opacity",.75),d3.selectAll("#rTip-"+e).style("opacity",0),"zoomedIn"===mapStatus||"none"===mapStatus?d3.selectAll("#rTip-"+e).style("opacity",0):d3.selectAll("#rTip-"+e).style("opacity",1)}function sSearch(e){d3.selectAll(".dot").style("opacity",".25").style("fill",orange),d3.select("#dot-"+e).style("opacity",1).style("fill","#333"),d3.selectAll(".sTooltip").style("opacity",0),d3.selectAll(".sTooltipB").style("opacity",0),d3.selectAll(".sTooltip2").style("opacity",0),d3.selectAll(".sTooltip2B").style("opacity",0),d3.selectAll(".rDot").style("opacity",".025").style("fill","#333"),d3.selectAll(".rTooltip").style("opacity","0"),d3.selectAll(".conn").style("opacity",".05"),d3.selectAll("#sTip-"+e).style("opacity",0),d3.selectAll("#rTip-"+e).style("opacity",0),"zoomedIn"===mapStatus||"none"===mapStatus?d3.selectAll("#sTip-"+e).style("opacity",0):d3.selectAll("#sTip-"+e).style("opacity",1)}var category="All Categories",haystack=[];jQuery(document).ready(function($){function e(){return window.getComputedStyle(h.get(0),"::before").getPropertyValue("content").replace(/"/g,"").replace(/'/g,"")}function t(){i||(i=!0,window.requestAnimationFrame?window.requestAnimationFrame(s):setTimeout(s,300))}function s(){var t=e();if("desktop"==t&&0==p.siblings(".cd-main-search").length)l.detach().insertBefore(p),n.detach().insertBefore(l).find(".cd-serch-wrapper").remove();else if("mobile"==t&&0!=h.children(".cd-main-nav-wrapper").length){n.detach().insertAfter(".cd-main-content");var s=$('<li class="cd-serch-wrapper"></li>');l.detach().appendTo(s),s.appendTo(a)}i=!1}function o(){r.removeClass("search-form-visible"),l.removeClass("is-visible"),d.removeClass("search-form-visible")}updateHaystack(category);var i=!1,n=$(".cd-main-nav-wrapper"),a=n.children(".cd-main-nav"),l=$(".cd-main-search"),c=$(".cd-main-content"),r=$(".cd-search-trigger"),d=$(".cd-cover-layer"),p=$(".cd-nav-trigger"),h=$(".cd-main-header"),y=$(".cd-search-suggestions");!Modernizr.testProp("pointerEvents")&&$("html").addClass("no-pointerevents"),s(),$(window).on("resize",t),r.on("click",function(e){e.preventDefault(),r.hasClass("search-form-visible")?l.find("form").submit():($(".cd-main-header").addClass("cd-main-header-open"),$(".newLinks").addClass("newLinksVisible"),r.addClass("search-form-visible"),d.addClass("search-form-visible"),l.addClass("is-visible").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){l.find('input[type="search"]').focus().end().off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")}))}),l.on("click",".close",function(){o(),$(".cd-main-header").removeClass("cd-main-header-open"),$(".cd-search-suggestions").removeClass("cd-search-suggestionsVisible"),$(".cd-search-suggestions").addClass("cd-search-suggestionsInvisible"),$(".newLinks").removeClass("newLinksVisible")}),d.on("click",function(){o(),$(".cd-main-header").removeClass("cd-main-header-open"),$(".cd-search-suggestions").removeClass("cd-search-suggestionsVisible"),$(".cd-search-suggestions").addClass("cd-search-suggestionsInvisible"),$(".newLinks").removeClass("newLinksVisible")}),$(document).keyup(function(e){"27"==e.which&&o()}),l.on("change","select",function(){l.find(".selected-value").text($(this).children("option:selected").text()),category=$(this).children("option:selected").text(),updateHaystack(category)}),l.keyup(function(){var e=$(this).find("input").val();$(".newLinks").removeClass("newLinksVisible"),runSearch(e)})}),$(".o1").on("click",function(e){var t=$(this).find(".oA").text().split(",");optionClick(t[0],t[1],t[2],t[3],t[4])}),$(".o2").on("click",function(e){var t=$(this).find(".oA").text().split(",");optionClick(t[0],t[1],t[2],t[3],t[4])}),$(".o3").on("click",function(e){var t=$(this).find(".oA").text().split(",");optionClick(t[0],t[1],t[2],t[3],t[4])});